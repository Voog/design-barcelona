!function(e){var r=function(r){bgPickerCombinedLightness>=.5?e(r).find(".js-background-type").addClass("light-background").removeClass("dark-background"):e(r).find(".js-background-type").addClass("dark-background").removeClass("light-background")},o=function(r,o){return function(r,o){if(r&&o){"string"==typeof r&&(r=r.replace(/rgba?\(/,"").replace(/\)/,"").split(","),e.each(r,function(e,o){r[e]=+o})),"string"==typeof o&&(o=o.replace(/rgba?\(/,"").replace(/\)/,"").split(","),e.each(o,function(e,r){o[e]=+r})),"object"==typeof r&&r.hasOwnProperty("length")&&3==r.length&&r.push(1),"object"==typeof o&&o.hasOwnProperty("length")&&3==o.length&&o.push(1);var n=[0,0,0,0];return n[3]=1-(1-o[3])*(1-r[3]),0===n[3]&&(n[3]=1e-6),n[0]=Math.min(o[0]*o[3]/n[3]+r[0]*r[3]*(1-o[3])/n[3],255),n[1]=Math.min(o[1]*o[3]/n[3]+r[1]*r[3]*(1-o[3])/n[3],255),n[2]=Math.min(o[2]*o[3]/n[3]+r[2]*r[3]*(1-o[3])/n[3],255),e.map(n,function(e){return Math.floor(e)})}}(r||[255,255,255,1],o||[255,255,255,1])},n=function(e,r){var n=o(e,r);return Math.round((.2126*+n[0]+.7152*+n[1]+.0722*+n[2])/2.55)/100};window.site=e.extend(window.site||{},{articleBgPreview:function(e,r){var o=r.find(".link");e.image&&""!==e.image?o.css("background-image",'url("'+e.image+'")'):o.css("background-image","none");var n=e.color&&""!==e.color?e.color:"transparent";r.find(".article-bg-color").css("background-color",n)},articleBgCommit:function(r,o,n){var a=e.extend(!0,{},r);a.image=a.image||"",a.color=a.color||"",o.set(n,a)},bgPickerPreview:function(o,a,i){var t=e(o).css("background-image"),g=a.imageSizes?function(e,r){for(var o,n=0,a=e.length;n<a;n++){if(e[n].width<r)return o||e[n];o=e[n]}return e[e.length-1]}(a.imageSizes,e(window).width()):null,c=a.image&&""!==a.image?"url("+g.url+")":"none",s=a.imageSizes&&""!==a.imageSizes?a.imageSizes:null,l=a.color&&""!==a.color?a.color:"rgba(0,0,0,0)",u=(a.colorData&&""!==a.colorData&&a.colorData.lightness,e("<img>")),d=e("<canvas>"),m=a.image&&""!==a.image?a.image:null;m?function(e,r){for(var o=e.length;o--;)if(r.indexOf(e[o].url.trim())>-1)return!0;return!1}(s,t)?(bgPickerCombinedLightness=n(i.bgPickerImageColor,l),r(o)):(u.attr("src",m.replace(/.*\/(photos|voogstock)/g,"/photos")),u.on("load",function(){ColorExtract.extract(u[0],d[0],function(e){i.bgPickerImageColor=e.bgColor?e.bgColor:"rgba(255,255,255,1)",bgPickerCombinedLightness=n(i.bgPickerImageColor,l),r(o)})})):(bgPickerCombinedLightness=n("rgba(255,255,255,1)",l),r(o)),e(o).css({"background-image":c}),e(o).find(".js-background-color").css({"background-color":l})},bgPickerCommit:function(r,o){var n=e.extend(!0,{},o);n.image=o.image||"",n.imageSizes=function(e){return null==e||"string"==typeof e&&e.match(/^[\\'"]+$/)?"":e}(o.imageSizes),n.color=o.color||"rgba(255,255,255,0)",n.combinedLightness=bgPickerCombinedLightness,pageData.set(r,n)},bgPickerColorScheme:function(r){void 0!==r&&(r>.6?e(".header-wrapper").addClass("light").removeClass("dark"):e(".header-wrapper").addClass("dark").removeClass("light"))}})}(jQuery);